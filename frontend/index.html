<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Telegram Calendar MiniApp</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { font-size: 24px; }
    label { display: block; margin-top: 10px; }
    input, select { margin-top: 5px; width: 100%; padding: 5px; }
    button { margin-top: 10px; padding: 10px 15px; cursor: pointer; transition: transform 0.1s; }
    button:active { transform: scale(0.95); background-color: #ddd; }
    .event { border: 1px solid #ddd; padding: 10px; margin-top: 10px; border-radius: 5px; position: relative; }
    .repeat { font-size: 12px; color: gray; }
    .delete-btn { position: absolute; top: 5px; right: 5px; cursor: pointer; color: red; background: none; border: none; font-weight: bold; }
  </style>
</head>
<body>
  <h1>Календарь событий</h1>

  <div>
    <label>Название события
      <input type="text" id="eventTitle" placeholder="Введите название">
    </label>

    <label>Дата
      <input type="date" id="eventDate">
    </label>

    <label>Время
      <input type="time" id="eventTime">
    </label>

    <label>
      <input type="checkbox" id="isRepeat"> Повторяемое событие
    </label>

    <div id="repeatOptions" style="display:none; margin-top:10px;">
      <label>Повторять каждую неделю:
        <select id="repeatDays" multiple>
          <option value="Пн">Пн</option>
          <option value="Вт">Вт</option>
          <option value="Ср">Ср</option>
          <option value="Чт">Чт</option>
          <option value="Пт">Пт</option>
          <option value="Сб">Сб</option>
          <option value="Вс">Вс</option>
        </select>
      </label>
    </div>

    <button id="addEvent">Сохранить событие</button>
  </div>

  <h2>Сохранённые события</h2>
  <div id="eventList"></div>

  <script>
    const isRepeat = document.getElementById('isRepeat');
    const repeatOptions = document.getElementById('repeatOptions');
    const addEventBtn = document.getElementById('addEvent');
    const eventList = document.getElementById('eventList');

    isRepeat.addEventListener('change', () => {
      repeatOptions.style.display = isRepeat.checked ? 'block' : 'none';
    });

    const events = [];

    function checkExpiredEvents() {
      const now = new Date();
      return events.filter(ev => {
        const evDateTime = new Date(`${ev.date}T${ev.time}`);
        // Удаляем не повторяемые события из прошлого
        if (!ev.repeat && evDateTime < now) return false;
        return true;
      });
    }

    function renderEvents() {
      eventList.innerHTML = '';
      const activeEvents = checkExpiredEvents();
      activeEvents.forEach((ev, idx) => {
        const div = document.createElement('div');
        div.className = 'event';
        div.innerHTML = `<strong>${ev.title}</strong><br>${ev.date} ${ev.time}`;
        if (ev.repeat) {
          div.innerHTML += `<div class="repeat">Повторяется: ${ev.days.length ? ev.days.join(', ') : 'раз в неделю'}</div>`;
        }
        const delBtn = document.createElement('button');
        delBtn.textContent = '×';
        delBtn.className = 'delete-btn';
        delBtn.addEventListener('click', () => {
          events.splice(idx, 1);
          renderEvents();
        });
        div.appendChild(delBtn);
        eventList.appendChild(div);
      });
    }

    addEventBtn.addEventListener('click', () => {
      const title = document.getElementById('eventTitle').value.trim();
      const date = document.getElementById('eventDate').value;
      const time = document.getElementById('eventTime').value;
      const repeat = isRepeat.checked;
      const days = Array.from(document.getElementById('repeatDays').selectedOptions).map(o => o.value);

      if (!title || !date || !time) {
        alert('Заполните все поля!');
        return;
      }

      events.push({ title, date, time, repeat, days });
      renderEvents();

      // Сброс формы
      document.getElementById('eventTitle').value = '';
      document.getElementById('eventDate').value = '';
      document.getElementById('eventTime').value = '';
      isRepeat.checked = false;
      repeatOptions.style.display = 'none';
    });

    // Проверяем и удаляем устаревшие события каждые 30 секунд
    setInterval(renderEvents, 30000);
  </script>
</body>
</html>
